/**
 * Advanced Anti Spam Google reCAPTCHA PrestaShop Module.
 *
 * @author      ReduxWeb <contact@reduxweb.net>
 * @copyright   2017-2021
 * @license     LICENSE.txt
 */

var AdvancedEmailGuard=function(){"use strict";var r,c,a,n,s={},t="65 100 118 97 110 99 101 100 32 65 110 116 105 32 83 112 97 109 32 71 111 111 103 108 101 32 114 101 67 65 80 84 67 72 65 32 40 99 41 32 67 111 112 121 114 105 103 104 116 32 50 48 49 55 45 50 48 50 48 32 82 101 100 117 120 87 101 98 32 119 119 119 46 114 101 100 117 120 119 101 98 46 110 101 116",e="AdvancedEmailGuard",o=e+"Data",i=e+"InitRecaptcha",p="g-recaptcha-response",h="adveg-grecaptcha";s.booted=!1,s.recaptchaForms={},s.googleRecaptchaCallback=null,s.googleRecaptchaCallbackBefore=null;function u(){return t.split(" ").map(function(t){return String.fromCharCode(t)}).join("").replace("{{date}}",(new Date).getFullYear())}var m={},d={},l=!1,f=0;s.extends=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},s.isObj=function(t){return null!==t&&"object"==typeof t&&!Array.isArray(t)},s.isDef=function(t){return null!=t},s.queryToObj=function(t){var e={};return"string"!=typeof t||(0===(t=t.replace(/^\&+|\&+$/g,"")).lastIndexOf("?")&&(t=t.substr(1)),t.split("&").forEach(function(t){t=t.split("=");e[t[0]]=decodeURIComponent(t[1])})),e},s.strToStudly=function(t){return t.replace(/^[a-z]|([-_][a-z])/gi,function(t){return t.toUpperCase().replace("-","").replace("_","")})};var b=function(){g("contact_us",a.ps.v17pc?"form:has(button[name=submitMessage], input[name=submitMessage])":"form:not(#id_new_comment_form):has(button[name=submitMessage], input[name=submitMessage])"),g("register",a.ps.v17?"body:not(#checkout):not(#identity) form:has(button[name=submitCreate], input[name=submitCreate])":C()?"#opc_account_form:visible:has(button[name=submitAccount], input[name=submitAccount])":"form:has(button[name=submitAccount], input[name=submitAccount])"),g("login",a.ps.v17?"form:has(button[name=submitLogin], input[name=submitLogin])":"form:has(button[name=SubmitLogin], input[name=SubmitLogin])"),g("reset_password",a.ps.v17?"form.forgotten-password":"#form_forgotpassword",a.ps.v17?"button[type=submit]:visible, input[type=submit]:visible":"button[type=submit], input[type=submit]"),g("quick_order",a.ps.v17?"body#checkout form:has(button[name=submitCreate], input[name=submitCreate])":C()?"#opc_account_form:visible:has(button[name=submitGuestAccount], input[name=submitGuestAccount])":"#new_account_form"),g("newsletter",a.ps.v15?"form:has(button[name=submitNewsletter], input[name=submitNewsletter]):visible":"form:has(button[name=submitNewsletter], input[name=submitNewsletter])",a.ps.v17?"button[type=submit]:visible, input[type=submit]:visible":"button[type=submit], input[type=submit]"),g("write_review",a.ps.v17pc?"#post-product-comment-form":"#id_new_comment_form"),g("notify_when_in_stock",r.isLegacyMAModuleEnabled?"form:has(#mailalert_link)":".js-mailalert",r.isLegacyMAModuleEnabled?"":"button[type=submit], input[type=submit], button:first"),g("send_to_friend","#send_friend_form_content")},g=function(t,e,i){m[t]||s.registerFormSelectors(t,e,i)};s.registerFormSelectors=function(t,e,i){m[t]={form:e,submit:i||"button[type=submit], input[type=submit]"}};var y=function(){for(var t in c.recaptcha.hidden&&0===$("#adveg-grecaptcha-legal").length&&(c.recaptcha.hidden=!1),c.recaptcha.forms)switch(s.recaptchaForms[t]=[],t){case"register":a.ps.v17||($(document).ajaxSuccess(function(t,e,i,a){i=s.queryToObj(i.data);"authentication"===i.controller&&s.isDef(i.SubmitCreate)&&!a.hasError&&setTimeout(function(){s.initRecaptchaForm("register")},700)}),C()&&($(document).on("click","#opc_createAccount",function(){setTimeout(function(){s.initRecaptchaForm("register")},700)}),$(document).ajaxSend(function(t,e,i){var a=s.queryToObj(i.data);"true"===a.ajax&&s.isDef(a.submitAccount)&&"1"===a.is_new_customer&&(i.data+=s.getRecFormTokenAsPayload("register"))})));break;case"login":C()&&$(document).ajaxSend(function(t,e,i){var a=s.queryToObj(i.data);"true"===a.ajax&&s.isDef(a.SubmitLogin)&&(i.data+=s.getRecFormTokenAsPayload("login"))});break;case"quick_order":C()&&($(document).on("click","#opc_guestCheckout",function(){setTimeout(function(){s.initRecaptchaForm("quick_order")},700)}),$(document).ajaxSend(function(t,e,i){var a=s.queryToObj(i.data);"true"===a.ajax&&s.isDef(a.submitAccount)&&"0"===a.is_new_customer&&(i.data+=s.getRecFormTokenAsPayload("quick_order"))}));break;case"notify_when_in_stock":var o=r.isLegacyMAModuleEnabled?"mailalerts":"ps_emailalerts";$(document).ajaxSend(function(t,e,i){i.url.includes(o)&&i.url.includes("process=add")&&(i.data+=s.getRecFormTokenAsPayload("notify_when_in_stock"))}),r.isLegacyMAModuleEnabled||$(document).ajaxSuccess(function(t,e,i,a){var n=s.queryToObj(i.data);i.url.includes("controller=product")&&"refresh"===n.action&&s.initRecaptchaForm("notify_when_in_stock")}),_()&&$(document).ajaxSuccess(function(t,e,i,a){if(i.url.includes(o)&&/process=(add|check)/.test(i.url)){var n=!1;if(r.isLegacyMAModuleEnabled)n="1"===a;else try{n=!1===JSON.parse(a).error}catch(t){}n&&s.isDef(s.recaptchaForms.notify_when_in_stock)&&s.recaptchaForms.notify_when_in_stock.forEach(function(t){t.$submit.is(":visible")||t.hideWidget()})}});break;case"send_to_friend":$(document).ajaxSend(function(t,e,i){"sendToMyFriend"===s.queryToObj(i.data).action&&(i.data+=s.getRecFormTokenAsPayload("send_to_friend"))})}},F=function(){var t,e=[];for(t in c.recaptcha.forms)s.isDef(m[t])&&e.push(m[t].form);return 0!==e.length&&0!==$(e.join(",")).length},v=function(t){var e;l||(e="?render=explicit&onload="+i,"shop"===c.recaptcha.language&&(e+="&hl="+a.languageCode),R(t),$("head").append('<script src="https://www.google.com/recaptcha/api.js'+e+'"><\/script>'))},R=function(t){window[i]=function(){l=!0,S(),"function"==typeof s.googleRecaptchaCallbackBefore&&s.googleRecaptchaCallbackBefore(),t(),"function"==typeof s.googleRecaptchaCallback&&s.googleRecaptchaCallback()}},k=function(){for(var t in c.recaptcha.forms)s.initRecaptchaForm(t)},S=function(){var t,e;"v3"===c.recaptcha.type&&(0===(e=$("#"+h)).length&&(t="inline"===c.recaptcha.position?"inline":"fixed",e=$('<div id="'+h+'" class="adveg-grecaptcha-'+t+'" />'),$("body").append(e)),f=grecaptcha.render(h,{sitekey:c.recaptcha.key,badge:c.recaptcha.position,theme:c.recaptcha.theme,size:"invisible"}),c.recaptcha.hidden&&e.hide())};s.initRecaptchaForm=function(i){if(!s.isDef(m[i]))throw new Error('No selector defined for the "'+i+'" form type.');var a=m[i],n=c.recaptcha.forms[i];if(!s.isDef(n))throw new Error('No params defined for the "'+i+'" form type.');var o=s.strToStudly(i)+"Form";s.isDef(s[o])||(o="RecaptchaForm");var t=$(a.form);0!==t.length&&(l?t.each(function(){var e=$(this),t=e.find(a.submit).first();s.recaptchaForms[i].some(function(t){return e.is(t.$form)})||s.recaptchaForms[i].push(new s[o](i,n,e,t))}):v(function(){s.initRecaptchaForm(i)}))},s.getRecFormWithToken=function(t){if(!s.isDef(s.recaptchaForms[t]))return null;for(var e=0;e<s.recaptchaForms[t].length;e++)if(""!==s.recaptchaForms[t][e].token)return s.recaptchaForms[t][e];return null},s.getRecFormTokenAsPayload=function(t){var e=s.getRecFormWithToken(t);if(null===e)return"";t=e.token;return e.onRecaptchaTokenExpired(),"&"+p+"="+t},s.getRecV3ID=function(){return f};var _=function(){return"v2_cbx"===c.recaptcha.type||"inline"===c.recaptcha.position},C=function(){return r.isLegacyOPCEnabled&&"order-opc"===a.pageName};return s.RecaptchaForm=function(t,e,i,a){this.recID=0,this.name=t,this.params=e,this.$form=i,this.$submit=a,this.$inner=null,this.$outer=null,this.token="",this.origHandler=null,this.$gdprCbx=null,this.init()},s.RecaptchaForm.prototype.getFormElement=function(){return this.$form.get(0)},s.RecaptchaForm.prototype.getSubmitElement=function(){return this.$submit.get(0)},s.RecaptchaForm.prototype.init=function(){this.setSubmitHandler(),"v2_cbx"===c.recaptcha.type&&(this.setGDPRHandler(),this.disableSubmitBtn()),"v3"!==c.recaptcha.type&&this.addRecaptchaWidget()},s.RecaptchaForm.prototype.disableSubmitBtn=function(){this.$submit.prop("disabled",!0).addClass("adveg-grecaptcha-btn-disabled")},s.RecaptchaForm.prototype.enableSubmitBtn=function(){this.$submit.prop("disabled",!1).removeClass("adveg-grecaptcha-btn-disabled")},s.RecaptchaForm.prototype.setGDPRHandler=function(){var t=this.$form.find("input[name=psgdpr_consent_checkbox]");0!==t.length&&(this.$gdprCbx=t,t="."+this.$gdprCbx.attr("class"),$(document).off("change",t),this.$gdprCbx.on("change",this.onGDPRCheckboxChange.bind(this)))},s.RecaptchaForm.prototype.onGDPRCheckboxChange=function(){""!==this.token&&this.isGDPRChecked()?this.enableSubmitBtn():this.disableSubmitBtn()},s.RecaptchaForm.prototype.isGDPRChecked=function(){return null===this.$gdprCbx||this.$gdprCbx.is(":checked")},s.RecaptchaForm.prototype.setSubmitHandler=function(){this.$form.submit(this.onFormSubmit.bind(this))},s.RecaptchaForm.prototype.onFormSubmit=function(t){"v2_cbx"!==c.recaptcha.type&&(""===this.token?("v3"===c.recaptcha.type?(this.disableSubmitBtn(),grecaptcha.execute(f,{action:this.name}).then(this.onRecaptchaToken.bind(this),this.onRecaptchaError.bind(this))):grecaptcha.execute(this.recID),t.preventDefault()):this.insertInputWithToken())},s.RecaptchaForm.prototype.setSubmitFormHandler=function(){var t=this.getFormElement();if(!s.isDef(d[this.name])){var e=$._data(t,"events");if(!s.isDef(e)||!Array.isArray(e.submit)||0===e.submit.length)return;d[this.name]=e.submit[0].handler}this.origHandler=d[this.name].bind(t),this.$form.off("submit"),this.$form.submit(this.onFormSubmitProxy.bind(this))},s.RecaptchaForm.prototype.setSubmitClickHandler=function(){if(!s.isDef(d[this.name])){var t=$._data(this.getSubmitElement(),"events");if(!s.isDef(t)||!Array.isArray(t.click)||0===t.click.length)return;d[this.name]=t.click[0].handler}this.origHandler=d[this.name],this.$submit.off("click"),this.$submit.click(this.onFormSubmitProxy.bind(this))},s.RecaptchaForm.prototype.setDocClickHandler=function(e){if(!s.isDef(d[this.name])){var t=$._data(document,"events").click.find(function(t){return t.selector===e});if(!s.isDef(t))return;d[this.name]=t.handler}this.origHandler=d[this.name],$(document).off("click",e),$(document).on("click",e,this.onFormSubmitProxy.bind(this))},s.RecaptchaForm.prototype.setGlobalFuncHandler=function(t){if(!s.isDef(d[this.name])){if(!s.isDef(window[t]))return;d[this.name]=window[t]}this.origHandler=d[this.name],window[t]=this.onFormSubmitProxy.bind(this)},s.RecaptchaForm.prototype.onFormSubmitProxy=function(t){var e;return"v2_cbx"===c.recaptcha.type?(e=this.origHandler(t),this.disableSubmitBtn(),grecaptcha.reset(this.recID)):""===this.token?("v3"===c.recaptcha.type?(this.disableSubmitBtn(),grecaptcha.execute(f,{action:this.name}).then(this.onRecaptchaToken.bind(this),this.onRecaptchaError.bind(this))):grecaptcha.execute(this.recID),s.isObj(t)&&t.preventDefault&&t.preventDefault()):(this.insertInputWithToken(),e=this.origHandler(t),"v3"===c.recaptcha.type?this.onRecaptchaTokenExpired():grecaptcha.reset(this.recID)),s.isDef(e)?e:!!s.isDef(t)&&void 0},s.RecaptchaForm.prototype.onRecaptchaToken=function(t){this.token=t,("v3"===c.recaptcha.type||"v2_cbx"===c.recaptcha.type&&this.isGDPRChecked())&&this.enableSubmitBtn(),"v2_cbx"!==c.recaptcha.type&&this.submitForm()},s.RecaptchaForm.prototype.onRecaptchaTokenExpired=function(){this.token="","v2_cbx"===c.recaptcha.type&&this.disableSubmitBtn()},s.RecaptchaForm.prototype.onRecaptchaError=function(){"v3"===c.recaptcha.type&&this.enableSubmitBtn(),alert("reCAPTCHA: "+n.genericError)},s.RecaptchaForm.prototype.insertInputWithToken=function(){var t;"v3"===c.recaptcha.type&&(0===(t=this.$form.find("textarea[name="+p+"]")).length&&(t=$('<textarea name="'+p+'" style="display: none;"></textarea>'),this.$form.append(t)),t.val(this.token))},s.RecaptchaForm.prototype.submitForm=function(){this.$submit.click()},s.RecaptchaForm.prototype.addRecaptchaWidget=function(){this.createRecaptchaContainer(),this.insertRecaptchaContainer(),this.renderRecaptchaWidget()},s.RecaptchaForm.prototype.createRecaptchaContainer=function(){var t;this.$inner=$('<div class="adveg-grecaptcha" />'),this.$outer=this.$inner,_()?(this.$inner.addClass("adveg-grecaptcha-inline"),t=this.$submit.parent().parent().hasClass("row"),"offset"===this.params.align?(this.$outer=this.$inner.wrap("<div />").parent(),this.$outer.addClass("col-md-"+(12-this.params.offset)+" col-md-offset-"+this.params.offset+" offset-md-"+this.params.offset),t||(this.$outer=this.$outer.wrap('<div class="row" />').parent())):(this.$inner.addClass("adveg-grecaptcha-"+this.params.align),t&&(this.$outer=this.$outer.wrap('<div class="col-xs-12" />').parent()))):this.$inner.addClass("adveg-grecaptcha-fixed")},s.RecaptchaForm.prototype.insertRecaptchaContainer=function(){(this.$submit.parent().is(this.$form)?this.$submit:this.$submit.parent()).before(this.$outer),_()&&this.$outer.before('<div class="clearfix" />')},s.RecaptchaForm.prototype.renderRecaptchaWidget=function(){this.recID=grecaptcha.render(this.getWidgetContainer(),this.getRecaptchaParams()),c.recaptcha.hidden&&this.hideWidget()},s.RecaptchaForm.prototype.getRecaptchaParams=function(){var t={sitekey:c.recaptcha.key,callback:this.onRecaptchaToken.bind(this),"expired-callback":this.onRecaptchaTokenExpired.bind(this),"error-callback":this.onRecaptchaError.bind(this),theme:c.recaptcha.theme};return"v2_cbx"===c.recaptcha.type?t.size=this.params.size:(t.size="invisible",t.isolated=!0,t.badge=c.recaptcha.position),t},s.RecaptchaForm.prototype.getWidgetContainer=function(){return this.$inner.get(0)},s.RecaptchaForm.prototype.hideWidget=function(){"v3"!==c.recaptcha.type&&this.$outer.hide()},s.RegisterForm=function(t,e,i,a){s.RecaptchaForm.call(this,t,e,i,a)},s.extends(s.RegisterForm,s.RecaptchaForm),s.RegisterForm.prototype.setSubmitHandler=function(){C()?a.ps.v16?this.setDocClickHandler("#submitAccount, #submitGuestAccount"):this.setSubmitClickHandler():s.RecaptchaForm.prototype.setSubmitHandler.call(this)},s.RegisterForm.prototype.insertRecaptchaContainer=function(){a.ps.v15&&!C()&&0!==this.$form.find("fieldset").length?this.$form.find("fieldset:last").append(this.$outer):s.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},s.LoginForm=function(t,e,i,a){s.RecaptchaForm.call(this,t,e,i,a)},s.extends(s.LoginForm,s.RecaptchaForm),s.LoginForm.prototype.onFormSubmit=function(t){a.ps.v17ch&&"order"===a.pageName&&this.$form.data("disabled",!1),s.RecaptchaForm.prototype.onFormSubmit.call(this,t)},s.LoginForm.prototype.setSubmitHandler=function(){C()?a.ps.v16?this.setDocClickHandler("#SubmitLogin"):this.setSubmitClickHandler():s.RecaptchaForm.prototype.setSubmitHandler.call(this)},s.QuickOrderForm=function(t,e,i,a){s.RecaptchaForm.call(this,t,e,i,a)},s.extends(s.QuickOrderForm,s.RecaptchaForm),s.QuickOrderForm.prototype.setSubmitHandler=function(){C()?a.ps.v16?this.setDocClickHandler("#submitAccount, #submitGuestAccount"):this.setSubmitClickHandler():s.RecaptchaForm.prototype.setSubmitHandler.call(this)},s.QuickOrderForm.prototype.onFormSubmit=function(t){a.ps.v17ch&&this.$form.data("disabled",!1),s.RecaptchaForm.prototype.onFormSubmit.call(this,t)},s.QuickOrderForm.prototype.insertRecaptchaContainer=function(){a.ps.v16&&!C()&&0!==this.$form.find(".box").length?this.$form.find(".box:last").append(this.$outer):a.ps.v15&&!C()&&0!==this.$form.find("fieldset:last").length?this.$form.find("fieldset:last").append(this.$outer):s.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},s.NewsletterForm=function(t,e,i,a){s.RecaptchaForm.call(this,t,e,i,a)},s.extends(s.NewsletterForm,s.RecaptchaForm),s.NewsletterForm.prototype.insertRecaptchaContainer=function(){"flex"===this.$submit.closest("div").css("display")?this.$submit.closest("div").before(this.$outer):s.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},s.NewsletterForm.prototype.setSubmitHandler=function(){s.isDef(window.psemailsubscription_subscription)?this.setSubmitFormHandler():s.RecaptchaForm.prototype.setSubmitHandler.call(this)},s.WriteReviewForm=function(t,e,i,a){s.RecaptchaForm.call(this,t,e,i,a)},s.extends(s.WriteReviewForm,s.RecaptchaForm),s.WriteReviewForm.prototype.setSubmitHandler=function(){a.ps.v17pc?this.setSubmitFormHandler():a.ps.v16?this.setDocClickHandler("#"+this.$submit.attr("id")):this.setSubmitClickHandler()},s.WriteReviewForm.prototype.insertRecaptchaContainer=function(){a.ps.v17pc?(this.$submit.parent().before(this.$outer),_()?this.$submit.closest(".post-comment-buttons").addClass("offset-md-6 offset-sm-6 col-md-offset-6 col-sm-offset-6"):function(){for(var t in s.recaptchaForms)if(0<s.recaptchaForms[t].length)return!0;return!1}()||this.$form.closest(".modal-dialog").attr("style","-webkit-transform: none!important; transform: none!important;")):s.RecaptchaForm.prototype.insertRecaptchaContainer.call(this)},s.NotifyWhenInStockForm=function(t,e,i,a){s.RecaptchaForm.call(this,t,e,i,a)},s.extends(s.NotifyWhenInStockForm,s.RecaptchaForm),s.NotifyWhenInStockForm.prototype.setSubmitHandler=function(){!r.isLegacyMAModuleEnabled&&this.$submit.hasClass("js-mailalert-add")?(this.setDocClickHandler(".js-mailalert-add"),this.origHandler&&(this.origHandler=this.origHandler.bind(this.getSubmitElement()))):this.setGlobalFuncHandler("addNotification")},s.NotifyWhenInStockForm.prototype.insertRecaptchaContainer=function(){this.$submit.before(this.$outer)},s.SendToFriendForm=function(t,e,i,a){s.RecaptchaForm.call(this,t,e,i,a)},s.extends(s.SendToFriendForm,s.RecaptchaForm),s.SendToFriendForm.prototype.setSubmitHandler=function(){this.setSubmitClickHandler()},s.run=function(){return s.booted||(s.isObj(window[o])&&(i=window[o],r=i.meta,c=i.settings,a=i.context,n=i.trans,null!==r.validationError&&(t=0,(e=$('<div id="adveg-validation-failed" style="display: none;"><div><div>'+r.validationError+'</div><button type="button"><span>&times;</span></button></div></div>')).appendTo("body"),e.find("button:first").on("click",function(){clearTimeout(t),e.slideUp(200)}),setTimeout(function(){e.slideDown(200),t=setTimeout(function(){e.slideUp(200)},4500)},700)),s.isObj(c.recaptcha.forms)&&(b(),y(),c.recaptcha.deferred&&!F()||v(k))),s.booted=!0),u;var t,e,i},s}();document.addEventListener("DOMContentLoaded",AdvancedEmailGuard.run),String.prototype.includes||(String.prototype.includes=function(t,e){"use strict";if(t instanceof RegExp)throw TypeError("first argument must not be a RegExp");return void 0===e&&(e=0),-1!==this.indexOf(t,e)});